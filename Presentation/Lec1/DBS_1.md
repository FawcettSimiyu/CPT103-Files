 # DBS week 1

## Outline

1. What is data
2. What is database
3. DBMS
4. The relational model
   1. Terminologies
   2. Relation

## Intro

你好欢迎来到再一课，从今天开始我们来讲解CPT103, 也就是数据库导论的内容。从这门课的教学大纲来看，这门课主要会教授关系型数据库的应用层面的知识，也就是说大部分是教会关系型数据库的基本操作和理念，结合学校教学进度来看的话，前两节课主要重点在关系型数据库的理论基础上，也就是关系代数，为之后3节课的关系型数据库操作内容打下基础，这就类似于在学习平面几何之前需要先学习平面直角坐标系一样。在这学期最后3个章节中，将会介绍数据库范式以及事务等更高级的概念。如果说这门课是叫做Excel导论，那么前两周就是在教大家，数学中的集合的基本概念，包括交集并集补集之类的，从第三周开始就开始教学Excel怎么创建表格，插入行，删除行之类的操作，第六周之后就是教如何设计一个更加高效的Excel表格

## Outline

这门课总体上并不难，虽说是数据库，但是数据库的底层实现基本不会提到，大家将这门课当作是现在最流行的关系型数据库，MySQL的入门教学即可。

现在我们进入这么课的第一章，第一节课将会花一般的时间介绍一下数据库的一些基本概念，包括数据、数据库以及数据库管理系统，之后就开始关系型数据库所需要的数学基础的讲解。

## 数据的定义（Data）

虽然很老套，但是一般老师不都是会先问大家，数据是啥？基本就是所有信息，就拿大家都有的网络昵称来作为例子，涉及到这个网络昵称的操作，总结下来只有四类，首先，你需要创建一个网络昵称，其次，你的好友十有八九会问你，你的昵称是啥，这就是查询，然后你长大了，非主流昵称想要修改，这就是更新，之后如果要退网了，那就需要删除这个昵称，如果大家用这四种操作的角度去看你们所有的数据，你们的购物车数据，朋友圈动态，订单，等等，任何你觉得是数据的东西，以及所有对这些数据的操作，全部都可以被归类为这4类操作，再比如你上知乎，你需要创建一个回答，之后修改这个回答的内容，也就是更新，然后别人可以从知乎的数据库中查询到你这篇回答，最后的最后，你拥有删除这篇回答的权限。

这四个数据操作就是接下来学习关系型数据库的四个基本面，如何创建，是一系列MySQL语句，如何查询又是一大堆命令，之后的课程安排也将完全按照这四个基本操作来进行，所以希望大家可以记住这四类操作，然后在之后的关系代数以及MySQL语句的学习中，希望大家在学习的同时，自动联想到某个操作属于CRUD哪一个。

## 数据库是什么

将一类数据组合起来之后，就可以称之为数据库了，比如这里，左下角把数据按行存在了txt文件里面，右下角把数据存在力excel表格里面，上面则是把数据存在了JSON格式的文件里面，这三个例子都可以说是数据库。

接下来想让大家思考一下，你们平时是怎么记录笔记的，是不是会倾向与按照一定的规则来记录笔记？比如说一开始先写上这是第几章，作为大标题，然后在加子标题，记录笔记，这样的好处是啥？在你记录了一个学期的笔记之后，可能有一本书那么厚力，但是你想查看你在第三章记录的笔记，怎么查询？你不需要从第一页开始查看每一行的内容，只需要查看目录就可以，根据目录记录的页数，来到那一页。如果你的笔记是用Word\Markdown\Latex写的，那么十有八九使用的是这种目录结构，比如这张图片里面的内容，程序想要做到这点非常容易，根据标题记录位置不就可以了嘛。我举这个例子是为了说明，大量数据想要被计算机有效的存储，并提供一些功能给用户使用，比如查询功能，那么这些数据必须要按照一定规则存储。就会虽然与这门课无关，但是以上这种类似于书本目录结构的嵌套式结构，是一种典型的非关系型数据库，你们可能已经知道MySQL数据库是一种关系型数据库，那么非关系型数据库一般叫做NoSQL, 非常好记。

如果数据不结构化，比如这张截图里面的，每一行都是用英文写成自然语言，但是机器不懂英文呀，你输入ArtistId is 1, 他也不知道属性ArtistId的值，是1啊，即使你声明说，is前面是属性名，is后面是属性值，这个规则对于第一行管用，但是对于第二行完全没用，所以说什么是结构化？意思就是所有的数据，都按照同一个规则来组织，这样才能做到让代码替我们管理数据。

刚刚提到了非关系型数据库是类似与目录那样的层级结构，那么关系型数据库是啥样的呢？现阶段的话，大家可以完全将关系型数据库理解成Excel里面的表，就是表格这种二维数据结构，每一列就是属性，每一行就是值，关系型数据库的底层就是由一堆表组成的。

接下来这张图片中的表格，是MySQL 里对于表格的一些定义，实际上MySQL存的也是一堆表，看起来跟Excel的表是一模一样的，事实上如果你见过Office套件中的Access，你会发现Access跟Excel几乎长得一模一样，画风都是一样的，你看左边的是Excel而右边的是Access，但是Access是一种数据库，Excel则不是，这两者区别在哪里呢？为什么单单是表格的话并不可以称之为数据库呢？

首先，数据库中的表，他们是联系起来的，每张表的某个属性与另外一些表的属性是一样的，你比如一张表里面存储着国家信息，有个属性值叫做国家代码，另一张表里面存储着工人的信息，工人信息表中间也有个属性叫做国家代码，代表这个工人属于哪个国家，如果我想知道某个名叫Jack的工人的祖国的面积是多大，那么我先在工人信息表内找到名叫Jack的那一行，然后找到他的国家代码是什么，然后用这个国家代码去国家信息表查找那个国家的信息，以上操作，使用一行SQL语句就能做到，那么是谁去执行这个SQL语句的呢？

从这里开始，就将引入数据库管理系统的概念。如果数据库仅仅是很多跟excel一样的表组成的，那么数据库并没有提高多少效率。在Excel里面，如果你希望对表格进行一些查询骚操作，必须挑选出所有满足条件的行或者是列，那么你需要使用函数，但这个函数很难写，而且支持的操作并不多，同时excel提供了一种叫做Macro的东西，中文是宏，来进行一些骚操作，但问题是，这些操作只能在excel里面运行，其他工具没有任何办法使用这个东西，你能想象我用Java搭建一个网站，使用excel作为数据库么？

数据库与Excel的一个重要的区别就在于，他有DBMS，一个管理系统，这个管理系统将会是独立运行的，开放给所有人，同时提供了一种新的语言，在关系型数据库中，这种语言叫做Sequential Query Language, 序列化查询语言。总而言之，这个图中，底层的数据表以及上一层的DBMS，共同组成了MySQL这一类的数据库。主要流程就是，用户通过这个用户界面，使用DBMS能够理解的SQL语言，精确描述了用户想要的数据应该是哪些数据，要注意是SQL足够灵活的，只要你能用人话描述出来你想要啥，DBMS在收到请求之后，就会去底层的数据表里面找到数据，再返回给用户。

其实DBMS还可以干很多事情，比如支持并发访问，支持回滚数据，稳定不崩溃，等等，这些最后三周都会说到。

说到这里，宏观上来看数据库的结构就是这个样子，用户用SQL语言跟DBMS交互，DBMS跟底层原始数据交互，返回数据给用户，而我们这个学期的关键内容就是，该怎么写SQL语句，来精确的描述自己想要的数据，同时关系型数据库的底层数据表是用关系，将不同的数据联系起来的，而这个关系是怎么定义，不同的数据怎么归类，决定了你该如何编写写SQL语句。

## 关系型模型

### 定义

以上介绍只是从非常宏观的角度介绍了数据库大概是什么东西，现在我们要开始介绍数据库底层的数据是按照什么样的方式组织的。关系型模型可以将杂乱无章的数据结构化，而关系型模型本质上，就是一堆存储着数据的二维表，你把他们看成excel表没有任何违和感。从定义上来说，关系型模型就是多个relation的集合，一个relation实际上就是大家很常见的表，接下来介绍一张表里面的相关术语。

首先relation大家可以理解为excel的一张表，这里是一个非常简单的例子，这个表格总共3个属性，有3行值，其中，所谓属性，也就是黄色的那一行，这个表格总共有3个属性值，分别是CustomerID, CustomerName以及Status，所以说他的Degree是3。这三种属性是有限制条件的，比如第一个CustomerID, 他的限制条件就是必须是不重复的、大于0的阿拉伯数字，这个限制条件也就是Domain，中文是域，跟微积分里面那个domain差不多，使用来修饰属性的，表示属性可以取值的范围。这个属性有很多种，比如图中的属性status，他的domain是一个二分变量，也就是说要么是Active, 要么是Inactive, 只有两个值。

从纵向的角度去看，拿第一行作为例子，第一行中，属性CustomerID的值是1,CustomerName的值是Rick，Status的值是Active，这一行，也就是所谓的tuple。这个表格中一共有3行，所以说他的Cardinality是3。

接下来我们来说两个比较抽象的概念。如果说数据是血肉，relation schema更像支撑起血肉的骨架。我们来看上面这张图，这里有三行数据，这可以称之为是一个table，那么relation schema就是对于这张表的定义，他们属性有哪些，都叫啥，有啥限制条件，domain是什么，所有我刚刚所说的都可以称之为metadata，也就是描述数据的数据，他们在数据表创建之初就被定义了。再回到刚刚的例子，这张customer表的relation schema就是下图这个样子，Field列记录了属性的名字，Type规定了每个属性的数据类型，Null列定义了每一个属性是否可以为空值，Key值是个关键的属性，关乎到跟其他表的联系，我们之后会说到，Default列可以为每个属性定义默认值，这里第一行CustomerID有个Extra属性，意思是这个CustomerID在每次插入新数据的时候会自动增加1。以上我所说的Field、Type、Null、Key、Default、Extra，他们都是用来描述属性的，也就是Domain，而这一整个表，就是relation schema，描述属性的表，所谓metadata，描述数据的数据。

而Relational database schema则是一堆relation schema的集合

介绍完以上概念之后，理论上大家可以创建自己的table了，但是关系型数据库中，对于表还是有一些硬性规定的，比如表名和属性名不可以重复，数据只能是单个数据，不能是列表形式的数据，也就是说，这一行里，CustomerID必须是单个确定的值，不能同时是1或者是2。之后还有些属性了解一下就可以了，比如每行至少有些区别，属性和行的顺序无所谓。

### 关系键

接下来我们要讲一个非常非常重要的概念，也是数据库与excel表格最大的不同，关系键。我们以上所有的概念都在描述单一的表，这没办法体现什么叫关系啊对不对，至少两个表之间才会有关系在里面，那么应该有哪些关系呢？我会用一个实例来讲解。

首先第一张表描述了用户，他有id, full_name, created_at以及country_code的属性，另外一张是countries表，记录了国家相关信息，比如code, name, countinent_name。大家思考一下，这里哪个属性将两个表联系了起来？是国家代码，在第一张表中，国家代码表示这个用户是哪个国家的，第二张国家表中，code这个属性就是和上面那个users中的country_code相对应了起来。

举个例子，上面这一行是某个用户数据，他的国家代码是3, OK我知道国家代码了，我就去第二张表里面找代码是3的，找到了，是英国。

这里大家应该慢慢理解关系是怎么建立起来的了吧？就是通过一种协商，这种协商就是两张不同的表，每张表有属性跟另外一张表的某个属性是对应者的。在这里大家需要思考几个问题，首先，国家表中的code，可以重复吗？其次，第二张表中的code，可以被删除吗？

在回答第一个问题之前，我们要回顾一个知识点，数据表中的每一行，都是不允许重复的，也就是说任意合法的两行，必定有某个属性是不一样的。如果国家表重复力会发生啥？你比如我们看着国家表中的英国和法国那行，让他俩的code都变成3会咋样？那我从用户表顺过来找国家的时候，发现有俩code为3的国家，我人傻了，我就无法判断用户表里那个人是哪个国家的了。

第二个问题就很容易回答了，第二个表如果删除第三行，那么第一张表回来找国家的时候会发现，这里居然没有代号为3的国家，那必然会报错。

OK 到现在为止，我用非常非常粗糙的方式带大家理解一遍关系型数据库里面的关系是怎么做到的，不同的表之间是怎么做到联系起来的。现在我会开始介绍一些正式的概念，相信有了上面那个例子，接下来的概念应该不难理解。

首先是最最常见的主键，主键就是一个属性，比如说users表中的属性id就是一个主键，如果某个属性是主键，那么他的属性值必然是不可重复的，因为主键的一个重要作用就是唯一标识每一行，由于这个特性，别的表想要引用users表里的信息，那么就会用到users的主键，也就是id，而在上面的例子中，countries表的主键是code，被users引用。

如果说我这张表里面，没有一个属性是绝对不会重复的咋整？我们看第一张user表，假设不用id作为主键，full_name肯定是不能作为主键的，因为名字会重复呀，那如果我们假设在同一时间点，绝对只会有一个人注册用户，那么full_name和created_at可以联合作为一个主键，用两个属性来唯一表示这一行，极端一点，数据库不是规定了不能重复行嘛，那么我就说我这张表的主键是所有的属性的集合。这种属性的组合，就叫做超键，一个或者是多个属性组合起来，唯一标识某一行，主键是超键的子集，因为定义里面是一个或者多个属性。

注意这里第二个例子，id与created_at的组合，id已经可以唯一标识某一行了，我还要created_at干啥子？同时，有一些表有多个属性可以唯一标识某一行，比如说你的身份证号和护照号都可以唯一标识你，这里就引入一个新键：候选键

候选键首先能唯一标识某一行，其次不能再缩小了，就像上一页第二个例子一样，那个超键就不可以是候选键，一个表有时候会有多个候选键，选中其中一个当主键。

最后一个概念是外键，在连接关系中，一个连接的两端，一端是主键，比如国家表中的code，一端是外键，比如用户表里的country_code。

当数据库的表的数量增加到2个以上，同时各个数据表之间可能通过主键外键的方式联系起来之后，有一个问题就需要考虑了，那就是关系完整性。

首先主键不可为空，这个条件让关系得以存在，而不是说联系的另一端是空的，正如之前的例子提到过。

其次是参照完整性约束，这个概念比较复杂，总的来说就是主键和外见之间的联系必须是有意义的，举了例子，教师和系的关系，如果教师表中的系编号是外键，系表中系编号是主键，那么首先教师表里的系编号一定要在系表里面存在，因为你不可能给老师指派一个不存在的系对不对，如果这个教师所属与的系，不在这个系表里面，那么这个教师的系编号应该是空的，这样才能维护参照完整性约束。

参照完整性约束是一个很容易犯错的概念，需要根据实际情况来判断。



